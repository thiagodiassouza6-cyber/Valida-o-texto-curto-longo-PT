<!DOCTYPE html>
<html>
<head>
<title>Valida√ß√£o de Campos ‚Äî Acesso Restrito</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{
    --bg:#eef3f6;
    --card:#ffffff;
    --accent:#0066cc;
    --accent-2:#0b77d6;
    --muted:#6b7280;
    --success:#16a34a;
    --danger:#dc2626;
    --radius:12px;
    --shadow-light: 0 4px 12px rgba(2,6,23,0.05);
    --shadow-strong: 0 12px 40px rgba(2,6,23,0.1);
  }

  *{box-sizing:border-box}
  html,body{height:100%;}
  body{
    margin:0;
    font-family: "Inter", Arial, sans-serif;
    background: linear-gradient(180deg,var(--bg), #f7fafc 120%);
    color:#111827;
    padding:28px;
    position: relative; 
    overflow-x: hidden; 
  }

  /* ------------------------------------- */
  /* ESTILOS DA TELA DE LOGIN */
  /* ------------------------------------- */
  #login-overlay{
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(180deg, var(--bg), #f7fafc 120%);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000; 
  }
  .login-card{
    background: var(--card);
    padding: 40px;
    border-radius: 16px;
    box-shadow: var(--shadow-strong);
    width: 360px;
    text-align: center;
  }
  .login-card h2{
    margin-top: 0;
    font-size: 24px;
    color: var(--accent-2);
  }
  .login-card input[type="text"], 
  .login-card input[type="password"]{
    width: 100%;
    padding: 12px 14px;
    border-radius: 8px;
    border: 1px solid #e6e9ee;
    font-size: 15px;
  }
  
  .password-container {
      position: relative;
      width: 100%;
      margin-bottom: 15px;
  }

  .toggle-password {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--muted);
      font-size: 18px;
      transition: color 0.2s;
      user-select: none;
  }
  .toggle-password:hover {
      color: var(--accent);
  }

  .login-card button{
    width: 100%;
    padding: 12px;
    font-weight: 700;
  }
  .login-card .error-msg {
    color: var(--danger);
    font-size: 14px;
    margin-top: 10px;
    display: none;
  }

  /* ------------------------------------- */
  /* ESTILOS DA P√ÅGINA PRINCIPAL */
  /* ------------------------------------- */
  
  .wrap{
    display: none; 
    grid-template-columns: 360px 1fr;
    gap:28px;
    align-items:start;
    max-width:1200px;
    margin:0 auto;
    position: relative;
    z-index: 10; 
  }

  .abstract-bg-logo {
      position: fixed;
      bottom: -180px; 
      right: -180px;
      width: 700px; 
      height: auto;
      opacity: 0.12; 
      filter: blur(4px) grayscale(100%); 
      pointer-events: none; 
      z-index: 0;
      transform: rotate(-10deg); 
  }
  
  .card-left{
    background:var(--card);
    border-radius:var(--radius);
    padding:28px;
    box-shadow: var(--shadow-strong);
    min-height:220px;
    position: relative;
    z-index: 1;
  }
  .card-left .title{ font-size:24px; margin:10px 0 6px; font-weight:700; color:#0b1220; }
  .card-left .desc{ color:var(--muted); line-height:1.5; margin-bottom:12px; }
  .meta{ margin-top:12px; font-size:13px; color:var(--muted) }

  /* NOVO: Estilo para garantir que textos longos quebrem a linha no card */
  .meta span { 
    word-break: break-word; 
    display: block; /* Garante que o span ocupe toda a largura */
  }
  .meta strong {
      display: block; /* Garante que o label Strong fique em uma linha separada */
      margin-top: 10px;
  }


  .card-right{
    background: linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.95));
    padding:20px;
    border-radius:12px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.6), var(--shadow-light);
    backdrop-filter: blur(4px); 
    position: relative;
    z-index: 1;
  }

  form .row{
    display:flex;
    gap:12px;
    align-items:flex-start;
    margin-bottom:16px;
  }
  label{
    display:block;
    font-size:13px;
    color:#111827;
    font-weight:700;
    margin-bottom:8px;
  }
  .col{
    flex:1;
    min-width:0;
  }

  input[type="text"]{
    width:100%;
    padding:12px 14px;
    border-radius:10px;
    border:1px solid #e6e9ee;
    font-size:15px;
    color:#0f172a;
    background:#ffffff90; 
    transition:box-shadow .2s, border-color .2s;
  }
  input[type="text"]:focus{
    outline:none;
    border-color: var(--accent-2);
    box-shadow:0 0 0 3px rgba(0,102,204,0.1), 0 6px 18px rgba(11,119,214,0.12);
    background:#fff;
  }

  .actions{
    display:flex;
    gap:12px;
    justify-content:flex-end;
    margin-top:4px;
  }

  .btn{
    padding:10px 18px;
    font-size:14px;
    font-weight:600;
    border-radius:8px;
    cursor:pointer;
    border:1px solid transparent;
    transition:background-color .2s, opacity .2s, box-shadow .2s, transform .1s;
  }
  .btn:active{ transform: translateY(1px); }

  .btn-validate{ background:var(--accent); color:white; box-shadow:0 3px 8px rgba(0,102,204,0.25); }
  .btn-validate:hover{ background:var(--accent-2); box-shadow:0 4px 10px rgba(0,102,204,0.35); }
  
  .btn-clear{ background:#f3f4f6; color:var(--muted); border-color:#e6e9ee; box-shadow:var(--shadow-light); }
  .btn-clear:hover{ background:#e5e7eb; }
  
  .btn-pdf{ background:#10b981; color:white; box-shadow:0 3px 8px rgba(16,185,129,0.25); }
  .btn-pdf:hover{ background:#059669; box-shadow:0 4px 10px rgba(16,185,129,0.35); }


  .message{
    margin-top:18px;
    padding:12px 14px;
    border-radius:10px;
    display:none;
    font-weight:600;
  }
  .message.ok{ background:#ecfdf5; color:#065f46; border:1px solid #bbf7d0; display:block; }
  .message.err{ background:#fff1f2; color:#7f1d1d; border:1px solid #fecaca; display:block; }

  @media (max-width:980px){
    .wrap{ grid-template-columns: 1fr; }
    .card-left{ order:2 }
    .card-right{ order:1 }
    .controls{ display:none }
    .abstract-bg-logo{ display:none; }
  }
</style>
</head>
<body>
  
  <div id="login-overlay">
    <div class="login-card">
        <h2>Acesso Restrito</h2>
        <form onsubmit="event.preventDefault(); checkLogin();">
            <input type="text" id="username" placeholder="Usu√°rio" required>
            
            <div class="password-container">
                <input type="password" id="password" placeholder="Senha" required>
                <span class="toggle-password" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
            </div>

            <button type="submit" class="btn btn-validate">Entrar</button>
            <div id="login-error" class="error-msg">Usu√°rio ou senha incorretos.</div>
        </form>
    </div>
  </div>


  <img src="robozinho_abstrato.png" class="abstract-bg-logo" alt="Padr√£o Abstrato Robozinho">

  <div class="wrap" id="main-content"> 
    <aside class="card-left" id="cardToPrint">
      <div style="display:flex; gap:12px; align-items:center;">
        <img src="https://www.citypng.com/public/uploads/preview/nestle-logo-black-image-png-701751694709065phkqydygvl.png" alt="Nestl√© Logo" style="height:58px; border-radius:6px; background:white; padding:6px; box-shadow:0 2px 8px rgba(2,6,23,0.03);">
        <div>
          <div style="font-size:13px; color:var(--muted); font-weight:700;">Relat√≥rio</div>
          <div style="font-size:12px; color:var(--muted);">Gerado automaticamente</div>
        </div>
      </div>

      <div class="title">Valida√ß√£o de Campos</div>
      <div class="desc">Ferramenta oficial para compara√ß√£o entre o texto curto do cadastro e o texto longo do material. Use o bot√£o validar para checar a primeira palavra e gere o PDF para registro.</div>

      <div class="meta">
        <div><strong>Data:</strong> <span id="metaData">25/11/2025, 12:24:23</span></div>
        <div style="margin-top:6px;"><strong>Status:</strong> <span id="metaStatus">‚Äî</span></div>
      </div>

      <div class="meta" style="margin-top:0px;">
        <div style="font-size:16px; font-weight:700; margin-top: 18px; margin-bottom: 4px; color: #0b1220;">Dados Analisados</div>
        <div>
          <strong>Texto Curto:</strong> 
          <span id="pdfTextoCurto" style="color:#374151; font-weight: 500;">‚Äî</span>
        </div>
        <div>
          <strong>Texto Longo:</strong> 
          <span id="pdfTextoLongo" style="color:#374151; font-weight: 500;">‚Äî</span>
        </div>
      </div>
      </aside>

    <section class="card-right">
      <form onsubmit="event.preventDefault(); validarCampos();">
        <div class="row">
          <div class="col">
            <label for="textoCurto">TEXTO CURTO PT:</label>
            <input type="text" id="textoCurto" placeholder="Digite o texto curto...">
          </div>

          <div class="col">
            <label for="textoLongo">TEXTO LONGO PT:</label>
            <input type="text" id="textoLongo" placeholder="Digite o texto longo...">
          </div>
        </div>

        <div class="actions">
          <button type="button" class="btn btn-validate" onclick="validarCampos();">Validar</button>
          <button type="button" class="btn btn-clear" onclick="limparCampos();">Limpar</button>
          <button type="button" class="btn btn-pdf" onclick="gerarPDF();">Gerar PDF</button>
        </div>

        <div id="mensagem" class="message" style="display: none;"></div>
      </form>
    </section>
  </div>

<script>
  // Vari√°veis de Login
  const CORRECT_USER = 'mmd-indireto';
  const CORRECT_PASS = '@12345#';
  
  function checkLogin() {
      const user = document.getElementById('username').value;
      const pass = document.getElementById('password').value;
      const errorMsg = document.getElementById('login-error');

      if (user === CORRECT_USER && pass === CORRECT_PASS) {
          // Acesso concedido
          document.getElementById('login-overlay').style.display = 'none';
          document.getElementById('main-content').style.display = 'grid'; // Mostra o conte√∫do
          errorMsg.style.display = 'none';
      } else {
          // Erro no login
          errorMsg.style.display = 'block';
      }
  }

  function togglePasswordVisibility() {
      const passwordField = document.getElementById('password');
      const toggleIcon = document.querySelector('.toggle-password');
      
      if (passwordField.type === 'password') {
          passwordField.type = 'text';
          toggleIcon.innerText = 'üîí'; 
      } else {
          passwordField.type = 'password';
          toggleIcon.innerText = 'üëÅÔ∏è';
      }
  }


  document.getElementById('metaData').innerText = new Date().toLocaleString();

  function validarCampos(){
    const curto = document.getElementById('textoCurto').value.trim();
    const longo = document.getElementById('textoLongo').value.trim();
    const msg = document.getElementById('mensagem');
    const metaStatus = document.getElementById('metaStatus');

    // NOVO: Atualiza os campos no card antes de rodar a valida√ß√£o
    document.getElementById('pdfTextoCurto').innerText = curto || 'N√£o preenchido';
    document.getElementById('pdfTextoLongo').innerText = longo || 'N√£o preenchido';
    // FIM NOVO

    if(!curto || !longo){
      msg.className='message err';
      msg.innerText = 'Por favor, preencha ambos os campos.';
      msg.style.display='block';
      metaStatus.innerText = 'Incompleto';
      return;
    }

    const p1 = curto.split(/\s+/)[0];
    const p2 = longo.split(/\s+/)[0];

    // Verifica se a primeira palavra coincide (ignorando caixa)
    if(p1.toUpperCase() === p2.toUpperCase()){
      msg.className='message ok';
      msg.innerText = '‚úÖ Valida√ß√£o bem-sucedida! As primeiras palavras coincidem.';
      metaStatus.innerText = 'OK';
    } else {
      msg.className='message err';
      msg.innerText = '‚ùå Erro: A primeira palavra do TEXTO LONGO (' + p2 + ') n√£o coincide com a do TEXTO CURTO (' + p1 + ').';
      metaStatus.innerText = 'Diverg√™ncia';
    }
    msg.style.display='block';
  }

  function limparCampos(){
    document.getElementById('textoCurto').value='';
    document.getElementById('textoLongo').value='';
    document.getElementById('mensagem').style.display='none';
    document.getElementById('metaStatus').innerText = '‚Äî';
    // NOVO: Limpa os campos de registro tamb√©m
    document.getElementById('pdfTextoCurto').innerText = '‚Äî';
    document.getElementById('pdfTextoLongo').innerText = '‚Äî';
  }

  // Gera PDF a partir do elemento #cardToPrint (A4)
  async function gerarPDF(){
    // NOVO: Garante que os campos de registro tenham o valor mais atualizado dos inputs
    const curto = document.getElementById('textoCurto').value.trim();
    const longo = document.getElementById('textoLongo').value.trim();
    document.getElementById('pdfTextoCurto').innerText = curto || 'N√£o preenchido';
    document.getElementById('pdfTextoLongo').innerText = longo || 'N√£o preenchido';
    // FIM NOVO

    const element = document.getElementById('cardToPrint');

    const btns = document.querySelectorAll('.btn-pdf');
    btns.forEach(b=>{ b.disabled=true; b.style.opacity=0.7; b.innerText='Gerando...'; });

    try {
      const canvas = await html2canvas(element, { scale: 2, useCORS:true, allowTaint:true, logging:false });
      const imgData = canvas.toDataURL('image/png', 1.0);

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p','pt','a4');
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();
      const margin = 28;

      const imgWidth = pageWidth - margin*2;
      const imgHeight = (canvas.height * imgWidth) / canvas.width;

      if(imgHeight <= (pageHeight - margin*2)){
        pdf.addImage(imgData, 'PNG', margin, margin, imgWidth, imgHeight);
      } else {
        // L√≥gica para m√∫ltiplas p√°ginas
        let remainingHeight = canvas.height;
        let position = 0;
        const pageCanvas = document.createElement('canvas');
        const ctx = pageCanvas.getContext('2d');

        const pxPerPt = canvas.width / imgWidth;
        const sliceHeightPx = Math.floor((pageHeight - margin*2) * pxPerPt);

        while(remainingHeight > 0){
          pageCanvas.width = canvas.width;
          pageCanvas.height = Math.min(sliceHeightPx, remainingHeight);
          ctx.clearRect(0,0,pageCanvas.width,pageCanvas.height);
          ctx.drawImage(canvas, 0, position, pageCanvas.width, pageCanvas.height, 0,0,pageCanvas.width,pageCanvas.height);
          const chunk = pageCanvas.toDataURL('image/png', 1.0);

          if(position === 0){
            pdf.addImage(chunk, 'PNG', margin, margin, imgWidth, (pageCanvas.height / canvas.width) * imgWidth);
          } else {
            pdf.addPage();
            pdf.addImage(chunk, 'PNG', margin, margin, imgWidth, (pageCanvas.height / canvas.width) * imgWidth);
          }

          remainingHeight -= pageCanvas.height;
          position += pageCanvas.height;
        }
      }

      const ts = new Date();
      const fname = `validacao_${ts.getFullYear()}${(ts.getMonth()+1).toString().padStart(2,'0')}${ts.getDate().toString().padStart(2,'0')}_${ts.getHours().toString().padStart(2,'0')}${ts.getMinutes().toString().padStart(2,'0')}.pdf`;
      pdf.save(fname);

    } catch(e){
      console.error('Erro ao gerar PDF', e);
      alert('Erro ao gerar PDF. Veja o console.');
    } finally {
      btns.forEach(b=>{ b.disabled=false; b.style.opacity=1; b.innerText='Gerar PDF'; });
    }
  }
</script>

</body>
</html>
